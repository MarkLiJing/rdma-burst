# RDMA å¤§æ–‡ä»¶ä¼ è¾“æœåŠ¡

åŸºäºä¸¤é˜¶æ®µä¼ è¾“æ¶æ„çš„ RDMA å¤§æ–‡ä»¶ä¼ è¾“ RESTful API æœåŠ¡ï¼Œæ”¯æŒè‡ªåŠ¨æ¨¡å¼æ£€æµ‹å’Œç»Ÿä¸€é…ç½®ç®¡ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½ä¼ è¾“**: æ”¯æŒ RDMA å¤§é¡µå†…å­˜ã€tmpfsã€æ–‡ä»¶ç³»ç»Ÿä¸‰ç§ä¼ è¾“æ¨¡å¼
- ğŸ”„ **ä¸¤é˜¶æ®µæ¶æ„**: å‡†å¤‡é˜¶æ®µå’Œä¼ è¾“é˜¶æ®µåˆ†ç¦»ï¼Œæä¾›æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†
- âš¡ **è‡ªåŠ¨æ¨¡å¼æ£€æµ‹**: æ”¯æŒæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯å’Œè‡ªåŠ¨æ¨¡å¼æ£€æµ‹
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: å®æ—¶ä¼ è¾“è¿›åº¦ã€é€Ÿåº¦ã€é”™è¯¯ä¿¡æ¯ç›‘æ§
- ğŸ”’ **é”™è¯¯æ¢å¤**: ä¼ è¾“ä¸­æ–­åçš„æ¢å¤æœºåˆ¶å’Œå®Œæ•´æ€§æ ¡éªŒ
- ğŸ³ **ç»Ÿä¸€é…ç½®**: å•ä¸€é…ç½®æ–‡ä»¶æ”¯æŒæ‰€æœ‰è¿è¡Œæ¨¡å¼

## ä¼ è¾“æ¨¡å¼

### 1. å¤§é¡µå†…å­˜ä¼ è¾“ (Hugepages)
- æœ€é«˜æ€§èƒ½çš„ä¼ è¾“æ¨¡å¼
- é€‚ç”¨äº 50GB+ å¤§æ–‡ä»¶ä¼ è¾“
- éœ€è¦é…ç½®å¤§é¡µå†…å­˜

### 2. tmpfs æ–‡ä»¶ä¼ è¾“
- å†…å­˜æ–‡ä»¶ç³»ç»Ÿä¼ è¾“
- å¹³è¡¡æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨
- é€‚ç”¨äºä¸­ç­‰å¤§å°æ–‡ä»¶

### 3. æ–‡ä»¶ç³»ç»Ÿä¼ è¾“
- ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¼ è¾“
- æœ€å¤§å…¼å®¹æ€§
- é€‚ç”¨äºé€šç”¨åœºæ™¯

## å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- Linux æ“ä½œç³»ç»Ÿ
- RDMA è®¾å¤‡æ”¯æŒ (mlx5_0)
- Go 1.21+ ç¯å¢ƒ

### å®‰è£…éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd rdma-burst

# 2. å®‰è£…ä¾èµ–
go mod tidy

# 3. æ„å»ºé¡¹ç›®
make build

# 4. é…ç½®å¤§é¡µå†…å­˜ (å¯é€‰ï¼Œä»…ç”¨äºhugepagesæ¨¡å¼)
echo 1024 > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
mkdir -p /dev/hugepages/dir
mount -t hugetlbfs nodev /dev/hugepages/dir

# 5. å¯åŠ¨æœåŠ¡ç«¯ï¼ˆåœ¨æœåŠ¡ç«¯æœºå™¨ä¸Šæ‰§è¡Œï¼‰
./build/rdma-burst --mode combined --config configs/combined.yaml
```

### API ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼ˆåœ¨æœåŠ¡ç«¯æœºå™¨ä¸Šï¼‰
curl http://localhost:8080/api/health

# 2. åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿä¼ è¾“ä»»åŠ¡ï¼ˆåœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šï¼Œæ›¿æ¢ä¸ºå®é™…æœåŠ¡ç«¯IPï¼‰
curl -X POST http://æœåŠ¡ç«¯IP:8080/api/v1/transfers \
  -H "Content-Type: application/json" \
  -d '{
    "filename": "/data/largefile.iso",
    "mode": "filesystem",
    "direction": "put"
  }'

# 3. æ£€æŸ¥ä¼ è¾“çŠ¶æ€
curl http://æœåŠ¡ç«¯IP:8080/api/v1/transfers/{task_id}

# 4. åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
curl http://æœåŠ¡ç«¯IP:8080/api/v1/transfers
```

### æ¨¡å¼æ£€æµ‹ API

```bash
# è·å–å½“å‰è¿è¡Œæ¨¡å¼
curl http://localhost:8080/api/v1/mode

# æ£€æµ‹è¿è¡Œæ¨¡å¼
curl http://localhost:8080/api/v1/mode/detect

# è·å–è¯¦ç»†æ¨¡å¼çŠ¶æ€
curl http://localhost:8080/api/v1/mode/status
```

## é¡¹ç›®ç»“æ„

```
rdma-burst/
â”œâ”€â”€ cmd/                 # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server/         # æœåŠ¡ç«¯ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ client/         # å®¢æˆ·ç«¯ä¸»ç¨‹åº
â”‚   â””â”€â”€ combined/       # ç»Ÿä¸€å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¨èï¼‰
â”œâ”€â”€ internal/           # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ api/           # API å¤„ç†å±‚ï¼ˆæ¨¡å¼æ£€æµ‹ã€ä¼ è¾“ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ services/      # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆä¸¤é˜¶æ®µä¼ è¾“æ¶æ„ï¼‰
â”‚   â”œâ”€â”€ models/        # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ wrapper/       # rtranfile åŒ…è£…å™¨
â”œâ”€â”€ configs/           # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ combined.yaml  # ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
â”œâ”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ start-server.sh    # æœåŠ¡å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ test-new-architecture.sh  # æ–°æ¶æ„æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ debug-transfer.sh  # ä¼ è¾“è°ƒè¯•è„šæœ¬
â”œâ”€â”€ tests/             # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/         # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/  # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/          # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ docs/              # æ–‡æ¡£
â”‚   â”œâ”€â”€ api/          # API æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/ # æ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ deployment/   # éƒ¨ç½²æ–‡æ¡£
â””â”€â”€ Makefile          # æ„å»ºè„šæœ¬
```

## é…ç½®è¯´æ˜

### ç»Ÿä¸€é…ç½® (configs/combined.yaml)

```yaml
# è¿è¡Œæ¨¡å¼é…ç½®
mode: "auto"  # server, client, auto

# æœåŠ¡ç«¯é…ç½®
server:
  host: "0.0.0.0"
  port: 8080

# å®¢æˆ·ç«¯é…ç½®
client:
  host: "10.208.63.11"  # æ›¿æ¢ä¸ºå®é™…æœåŠ¡ç«¯IP
  port: 8080

# ä¼ è¾“é…ç½®
transfer:
  device: "mlx5_0"
  base_dir: "/var/lib/rtrans"
  transfer_interval: "5s"
  max_concurrent_transfers: 1
  
  # ä¼ è¾“æ¨¡å¼é…ç½®
  modes:
    hugepages:
      enabled: true
      base_dir: "/dev/hugepages/dir"
    tmpfs:
      enabled: true
      base_dir: "/dev/shm/dir"
    filesystem:
      enabled: true
      base_dir: "/var/lib/rtrans/files"
```

## API æ–‡æ¡£

è¯¦ç»†çš„ API æ¥å£æ–‡æ¡£è¯·å‚è€ƒï¼š
- [RESTful API æ–‡æ¡£](docs/api/restful-api.md) - å®Œæ•´çš„APIæ¥å£è¯´æ˜
- [API å¿«é€Ÿå‚è€ƒ](docs/api-transfer-quick-reference.md) - å¸¸è§é—®é¢˜è§£ç­”
- [å¿«é€Ÿä½¿ç”¨æŒ‡å—](docs/quickstart-guide.md) - å¿«é€Ÿä¸Šæ‰‹æ•™ç¨‹

## å¼€å‘æŒ‡å—

### æ„å»ºé¡¹ç›®

```bash
# æ„å»ºæ‰€æœ‰ç›®æ ‡
make build

# ä»…æ„å»ºæœåŠ¡ç«¯
make server

# ä»…æ„å»ºå®¢æˆ·ç«¯
make client

# æ„å»ºç»Ÿä¸€å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¨èï¼‰
make combined
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œå•å…ƒæµ‹è¯•
make test-unit

# è¿è¡Œé›†æˆæµ‹è¯•
make test-integration

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
make test-e2e
```

### ä»£ç è§„èŒƒ

é¡¹ç›®éµå¾ªæ ‡å‡†çš„ Go ä»£ç è§„èŒƒï¼š
- ä½¿ç”¨ `make fmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `make vet` æ£€æŸ¥ä»£ç é—®é¢˜
- ä½¿ç”¨ `make lint` è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥

### å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
# å¼€å‘æ¨¡å¼è¿è¡ŒæœåŠ¡ç«¯
make run-server

# åˆ›å»ºå‘å¸ƒåŒ…
make dist

# å®‰è£…åˆ°ç³»ç»Ÿ
make install
```

## éƒ¨ç½²æŒ‡å—

### æœåŠ¡ç«¯éƒ¨ç½²

```bash
# 1. æ„å»ºé¡¹ç›®
make build

# 2. å¯åŠ¨æœåŠ¡ç«¯ï¼ˆæ¨èä½¿ç”¨ç»Ÿä¸€å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
./build/rdma-burst --mode combined --config configs/combined.yaml

# 3. éªŒè¯æœåŠ¡çŠ¶æ€
curl http://localhost:8080/api/health
```

### å®¢æˆ·ç«¯ä½¿ç”¨

```bash
# å®¢æˆ·ç«¯åªéœ€è¦é€šè¿‡HTTP APIä¸æœåŠ¡ç«¯é€šä¿¡
curl -X POST http://æœåŠ¡ç«¯IP:8080/api/v1/transfers \
  -H "Content-Type: application/json" \
  -d '{
    "filename": "/data/file.bin",
    "mode": "filesystem",
    "direction": "put"
  }'
```

### ç³»ç»ŸæœåŠ¡éƒ¨ç½²

å‚è€ƒ [éƒ¨ç½²æ–‡æ¡£](docs/deployment/README.md) äº†è§£ systemd æœåŠ¡é…ç½®å’Œç›‘æ§è®¾ç½®ã€‚

## æ•…éšœæ’é™¤

å¸¸è§é—®é¢˜è¯·å‚è€ƒï¼š
- [è°ƒè¯•æŒ‡å—](docs/debug-guide.md) - è¯¦ç»†çš„æ•…éšœæ’é™¤æ­¥éª¤
- [ä¼ è¾“å¤±è´¥åˆ†æ](docs/transmission-failure-analysis.md) - ä¼ è¾“é—®é¢˜åˆ†æ
- [å¿«é€Ÿä½¿ç”¨æŒ‡å—](docs/quickstart-guide.md) - å¸¸è§é—®é¢˜è§£ç­”

## å…³é”®æ”¹è¿›

### ä¸¤é˜¶æ®µä¼ è¾“æ¶æ„
- **å‡†å¤‡é˜¶æ®µ**: è‡ªåŠ¨å¯åŠ¨æœåŠ¡ç«¯ç›‘å¬è¿›ç¨‹ï¼ˆé€šè¿‡ `PrepareTransfer` æ–¹æ³•ï¼‰
- **ä¼ è¾“é˜¶æ®µ**: æ‰§è¡Œå®é™…çš„ä¼ è¾“ä»»åŠ¡ï¼ˆé€šè¿‡ `StartTransfer` æ–¹æ³•ï¼‰
- **èµ„æºå›æ”¶**: ä¼ è¾“å®Œæˆåè‡ªåŠ¨æ¸…ç†èµ„æº
- **è¶…æ—¶æœºåˆ¶**: æ·»åŠ 5ç§’è¶…æ—¶ï¼Œé¿å…APIè°ƒç”¨å¡ä½

### ç»Ÿä¸€é…ç½®ç®¡ç†
- å•ä¸€é…ç½®æ–‡ä»¶æ”¯æŒæ‰€æœ‰è¿è¡Œæ¨¡å¼ï¼ˆ`configs/combined.yaml`ï¼‰
- è‡ªåŠ¨æ¨¡å¼æ£€æµ‹å’Œåˆ‡æ¢ï¼ˆæ”¯æŒ `server`ã€`client`ã€`auto` æ¨¡å¼ï¼‰
- æ›´å¥½çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†

### API ç®€åŒ–
- å®¢æˆ·ç«¯åªéœ€ä¸€æ¬¡APIè°ƒç”¨å®Œæˆæ•´ä¸ªä¼ è¾“è¿‡ç¨‹
- æœåŠ¡ç«¯åœ°å€ä»é…ç½®æ–‡ä»¶ä¸­è·å–ï¼Œæ— éœ€åœ¨è¯·æ±‚ä¸­æŒ‡å®š
- æ”¯æŒæ¨¡å¼æ£€æµ‹APIï¼Œä¾¿äºè‡ªåŠ¨åŒ–éƒ¨ç½²

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼è¯·å‚è€ƒé¡¹ç›®è§„èŒƒæ–‡æ¡£ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: <repository-url>
- é—®é¢˜åé¦ˆ: <issues-url>
- æ–‡æ¡£: <docs-url>